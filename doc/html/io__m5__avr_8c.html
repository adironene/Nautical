<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Nautical: src/m5/io_m5_avr.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Nautical
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_f0a717be9bfa7f47d937d0cb8cccb477.html">m5</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">io_m5_avr.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;assert.h&gt;</code><br />
<code>#include &lt;avr/io.h&gt;</code><br />
<code>#include &lt;avr/interrupt.h&gt;</code><br />
<code>#include &lt;util/atomic.h&gt;</code><br />
<code>#include &lt;stdatomic.h&gt;</code><br />
<code>#include &quot;<a class="el" href="io__m5_8h_source.html">m5/io_m5.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dbg_8h_source.html">dbg.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="macrodef_8h_source.html">macrodef.h</a>&quot;</code><br />
<code>#include &lt;util/setbaud.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for io_m5_avr.c:</div>
<div class="dyncontent">
<div class="center"><img src="io__m5__avr_8c__incl.png" border="0" usemap="#src_2m5_2io__m5__avr_8c" alt=""/></div>
<map name="src_2m5_2io__m5__avr_8c" id="src_2m5_2io__m5__avr_8c">
<area shape="rect" id="node7" href="io__m5_8h.html" title="Low&#45;level communication function definitions for Videoray M5 motors. " alt="" coords="548,80,639,107"/>
<area shape="rect" id="node10" href="dbg_8h.html" title="dbg.h" alt="" coords="663,80,718,107"/>
<area shape="rect" id="node12" href="macrodef_8h.html" title="macrodef.h" alt="" coords="742,80,829,107"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a45719155cbf4258c29211c2f5db49b9b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a45719155cbf4258c29211c2f5db49b9b">NUSART</a>&#160;&#160;&#160;3</td></tr>
<tr class="separator:a45719155cbf4258c29211c2f5db49b9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59158b4881bf2b6001fb0d7d05dccbc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a59158b4881bf2b6001fb0d7d05dccbc5">DP_PORT</a>&#160;&#160;&#160;A</td></tr>
<tr class="separator:a59158b4881bf2b6001fb0d7d05dccbc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a390c9ef41751b0c4eba2676c2d61b3dc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a390c9ef41751b0c4eba2676c2d61b3dc">NDP</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a390c9ef41751b0c4eba2676c2d61b3dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62634036639f88eece6fbf226b45f84b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a62634036639f88eece6fbf226b45f84b">BAUD</a>&#160;&#160;&#160;115200UL</td></tr>
<tr class="separator:a62634036639f88eece6fbf226b45f84b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab14495ae1f9667df5d198613bcc8d092"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#ab14495ae1f9667df5d198613bcc8d092">NTIMER</a>&#160;&#160;&#160;3</td></tr>
<tr class="separator:ab14495ae1f9667df5d198613bcc8d092"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1635c00de18972072ae87c2a791b464"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#ac1635c00de18972072ae87c2a791b464">WAIT_MILLI</a>&#160;&#160;&#160;500ULL</td></tr>
<tr class="separator:ac1635c00de18972072ae87c2a791b464"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af05806eed98b2804b0afb2207456bda6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#af05806eed98b2804b0afb2207456bda6">PRESCALE_REG</a>&#160;&#160;&#160;(1U &lt;&lt; CC_XXX(CS, NTIMER, 0))</td></tr>
<tr class="separator:af05806eed98b2804b0afb2207456bda6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab27d12aac1a3a46aed25604d4c00cc18"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#ab27d12aac1a3a46aed25604d4c00cc18">PRESCALE</a>&#160;&#160;&#160;1ULL</td></tr>
<tr class="separator:ab27d12aac1a3a46aed25604d4c00cc18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09c3ffd40113e571d84b49a185b3bf6e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a09c3ffd40113e571d84b49a185b3bf6e">WAIT_TICKS</a></td></tr>
<tr class="separator:a09c3ffd40113e571d84b49a185b3bf6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09c3ffd40113e571d84b49a185b3bf6e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a09c3ffd40113e571d84b49a185b3bf6e">WAIT_TICKS</a>&#160;&#160;&#160;1ULL</td></tr>
<tr class="separator:a09c3ffd40113e571d84b49a185b3bf6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a446e415fc7a5645de4a012cf8a3cdf90"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a446e415fc7a5645de4a012cf8a3cdf90">WAIT_COUNT</a>&#160;&#160;&#160;(<a class="el" href="io__m5__avr_8c.html#a09c3ffd40113e571d84b49a185b3bf6e">WAIT_TICKS</a> - 1ULL)</td></tr>
<tr class="separator:a446e415fc7a5645de4a012cf8a3cdf90"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab71437ed7a0b59f87328b61002a1abaa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#ab71437ed7a0b59f87328b61002a1abaa">ISR</a> (<a class="el" href="io__m5__avr_8c.html#ad886765314d53f6e8cb3eeaac5bffda8">CC_XXX</a>(USART, <a class="el" href="io__m5__avr_8c.html#a45719155cbf4258c29211c2f5db49b9b">NUSART</a>, _TX_vect))</td></tr>
<tr class="separator:ab71437ed7a0b59f87328b61002a1abaa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad572b5e5dccab0f1c5a962e08ce2912e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#ad572b5e5dccab0f1c5a962e08ce2912e">io_m5_init</a> (char const *path)</td></tr>
<tr class="memdesc:ad572b5e5dccab0f1c5a962e08ce2912e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare M5 motors to receive data.  <a href="#ad572b5e5dccab0f1c5a962e08ce2912e">More...</a><br /></td></tr>
<tr class="separator:ad572b5e5dccab0f1c5a962e08ce2912e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57552be4efd362dfbaba37809d1f129d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a57552be4efd362dfbaba37809d1f129d">io_m5_clean</a> ()</td></tr>
<tr class="memdesc:a57552be4efd362dfbaba37809d1f129d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disable transmitting and receiving.  <a href="#a57552be4efd362dfbaba37809d1f129d">More...</a><br /></td></tr>
<tr class="separator:a57552be4efd362dfbaba37809d1f129d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cd0140ea705c077b6df15a1f606acfd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a3cd0140ea705c077b6df15a1f606acfd">ISR</a> (<a class="el" href="io__m5__avr_8c.html#ad886765314d53f6e8cb3eeaac5bffda8">CC_XXX</a>(USART, <a class="el" href="io__m5__avr_8c.html#a45719155cbf4258c29211c2f5db49b9b">NUSART</a>, _UDRE_vect))</td></tr>
<tr class="separator:a3cd0140ea705c077b6df15a1f606acfd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a515c36e7074c3d8f2a707f4dba147dd6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a515c36e7074c3d8f2a707f4dba147dd6">io_m5_trans_set</a> (int(*handler)())</td></tr>
<tr class="memdesc:a515c36e7074c3d8f2a707f4dba147dd6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tell M5 motors to start receiving data.  <a href="#a515c36e7074c3d8f2a707f4dba147dd6">More...</a><br /></td></tr>
<tr class="separator:a515c36e7074c3d8f2a707f4dba147dd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1297a12a88e41ab13442adb9bcace56d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a1297a12a88e41ab13442adb9bcace56d">io_m5_trans_stop</a> ()</td></tr>
<tr class="memdesc:a1297a12a88e41ab13442adb9bcace56d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops motors until resume is called.  <a href="#a1297a12a88e41ab13442adb9bcace56d">More...</a><br /></td></tr>
<tr class="separator:a1297a12a88e41ab13442adb9bcace56d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f3c3159f49e3e0d4532b3d535a9184d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a9f3c3159f49e3e0d4532b3d535a9184d">io_m5_tripbuf_offer_resume</a> ()</td></tr>
<tr class="memdesc:a9f3c3159f49e3e0d4532b3d535a9184d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resumes motors after stopping.  <a href="#a9f3c3159f49e3e0d4532b3d535a9184d">More...</a><br /></td></tr>
<tr class="separator:a9f3c3159f49e3e0d4532b3d535a9184d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c610858e0abe25cf8e34076675ad623"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a0c610858e0abe25cf8e34076675ad623">io_m5_tripbuf_update</a> ()</td></tr>
<tr class="memdesc:a0c610858e0abe25cf8e34076675ad623"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates tripbuf with new data.  <a href="#a0c610858e0abe25cf8e34076675ad623">More...</a><br /></td></tr>
<tr class="separator:a0c610858e0abe25cf8e34076675ad623"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a202b3ed317ffca6c49d8e70e7ba0d7a7"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a202b3ed317ffca6c49d8e70e7ba0d7a7">io_m5_tripbuf_write</a> ()</td></tr>
<tr class="memdesc:a202b3ed317ffca6c49d8e70e7ba0d7a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds the tripbuf index to write to.  <a href="#a202b3ed317ffca6c49d8e70e7ba0d7a7">More...</a><br /></td></tr>
<tr class="separator:a202b3ed317ffca6c49d8e70e7ba0d7a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17801e5afc9dfb2e05f1e96163cb2e84"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a17801e5afc9dfb2e05f1e96163cb2e84">io_m5_tripbuf_read</a> ()</td></tr>
<tr class="memdesc:a17801e5afc9dfb2e05f1e96163cb2e84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds the tripbuf index to read from.  <a href="#a17801e5afc9dfb2e05f1e96163cb2e84">More...</a><br /></td></tr>
<tr class="separator:a17801e5afc9dfb2e05f1e96163cb2e84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b85cc358fb2a10935417f00e3daa2d8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a6b85cc358fb2a10935417f00e3daa2d8">CC_XXX</a> (TIMSK, <a class="el" href="io__m5__avr_8c.html#ab14495ae1f9667df5d198613bcc8d092">NTIMER</a>,) &amp;</td></tr>
<tr class="separator:a6b85cc358fb2a10935417f00e3daa2d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8965273cef2ccefef88c849bff58d6f7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#a8965273cef2ccefef88c849bff58d6f7">CC_XXX</a> (TCCR, <a class="el" href="io__m5__avr_8c.html#ab14495ae1f9667df5d198613bcc8d092">NTIMER</a>, B) &amp;</td></tr>
<tr class="separator:a8965273cef2ccefef88c849bff58d6f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad886765314d53f6e8cb3eeaac5bffda8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#ad886765314d53f6e8cb3eeaac5bffda8">CC_XXX</a> (UCSR, <a class="el" href="io__m5__avr_8c.html#a45719155cbf4258c29211c2f5db49b9b">NUSART</a>, B)|</td></tr>
<tr class="separator:ad886765314d53f6e8cb3eeaac5bffda8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab00f04dfb16c64ae321fc5294371b749"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#ab00f04dfb16c64ae321fc5294371b749">io_m5_trans_trywait</a> ()</td></tr>
<tr class="memdesc:ab00f04dfb16c64ae321fc5294371b749"><td class="mdescLeft">&#160;</td><td class="mdescRight">Suspends data transmission until there is new data.  <a href="#ab00f04dfb16c64ae321fc5294371b749">More...</a><br /></td></tr>
<tr class="separator:ab00f04dfb16c64ae321fc5294371b749"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ac3eb02f1b9ff9632d44f0f20a8b18e2e"><td class="memItemLeft" align="right" valign="top">FILE *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5__avr_8c.html#ac3eb02f1b9ff9632d44f0f20a8b18e2e">io_m5</a></td></tr>
<tr class="separator:ac3eb02f1b9ff9632d44f0f20a8b18e2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a62634036639f88eece6fbf226b45f84b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62634036639f88eece6fbf226b45f84b">&#9670;&nbsp;</a></span>BAUD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BAUD&#160;&#160;&#160;115200UL</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a59158b4881bf2b6001fb0d7d05dccbc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59158b4881bf2b6001fb0d7d05dccbc5">&#9670;&nbsp;</a></span>DP_PORT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DP_PORT&#160;&#160;&#160;A</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a390c9ef41751b0c4eba2676c2d61b3dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a390c9ef41751b0c4eba2676c2d61b3dc">&#9670;&nbsp;</a></span>NDP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NDP&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab14495ae1f9667df5d198613bcc8d092"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab14495ae1f9667df5d198613bcc8d092">&#9670;&nbsp;</a></span>NTIMER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NTIMER&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a45719155cbf4258c29211c2f5db49b9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45719155cbf4258c29211c2f5db49b9b">&#9670;&nbsp;</a></span>NUSART</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUSART&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>See the ahrs <a class="el" href="io__ahrs__avr_8c.html">io_ahrs_avr.c</a> file for more verbose commenting on dealing with the avr usarts and interrupts.</p>
<p>Use is made of of atomic fences when memory ordering is desired relative to volatile access, but the standard seems to indicate atomic fences only preserve memory ordering relative to atomic type accesses. </p>

</div>
</div>
<a id="ab27d12aac1a3a46aed25604d4c00cc18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab27d12aac1a3a46aed25604d4c00cc18">&#9670;&nbsp;</a></span>PRESCALE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PRESCALE&#160;&#160;&#160;1ULL</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af05806eed98b2804b0afb2207456bda6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af05806eed98b2804b0afb2207456bda6">&#9670;&nbsp;</a></span>PRESCALE_REG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PRESCALE_REG&#160;&#160;&#160;(1U &lt;&lt; CC_XXX(CS, NTIMER, 0))</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a446e415fc7a5645de4a012cf8a3cdf90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a446e415fc7a5645de4a012cf8a3cdf90">&#9670;&nbsp;</a></span>WAIT_COUNT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WAIT_COUNT&#160;&#160;&#160;(<a class="el" href="io__m5__avr_8c.html#a09c3ffd40113e571d84b49a185b3bf6e">WAIT_TICKS</a> - 1ULL)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac1635c00de18972072ae87c2a791b464"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1635c00de18972072ae87c2a791b464">&#9670;&nbsp;</a></span>WAIT_MILLI</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WAIT_MILLI&#160;&#160;&#160;500ULL</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a09c3ffd40113e571d84b49a185b3bf6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09c3ffd40113e571d84b49a185b3bf6e">&#9670;&nbsp;</a></span>WAIT_TICKS <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WAIT_TICKS</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">(<a class="code" href="io__m5__avr_8c.html#ac1635c00de18972072ae87c2a791b464">WAIT_MILLI</a> * F_CPU + 1000ULL * <a class="code" href="io__m5__avr_8c.html#ab27d12aac1a3a46aed25604d4c00cc18">PRESCALE</a> / 2ULL) / \</div><div class="line">        (1000ULL * <a class="code" href="io__m5__avr_8c.html#ab27d12aac1a3a46aed25604d4c00cc18">PRESCALE</a>)</div><div class="ttc" id="io__m5__avr_8c_html_ab27d12aac1a3a46aed25604d4c00cc18"><div class="ttname"><a href="io__m5__avr_8c.html#ab27d12aac1a3a46aed25604d4c00cc18">PRESCALE</a></div><div class="ttdeci">#define PRESCALE</div><div class="ttdef"><b>Definition:</b> io_m5_avr.c:48</div></div>
<div class="ttc" id="io__m5__avr_8c_html_ac1635c00de18972072ae87c2a791b464"><div class="ttname"><a href="io__m5__avr_8c.html#ac1635c00de18972072ae87c2a791b464">WAIT_MILLI</a></div><div class="ttdeci">#define WAIT_MILLI</div><div class="ttdef"><b>Definition:</b> io_m5_avr.c:41</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a09c3ffd40113e571d84b49a185b3bf6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09c3ffd40113e571d84b49a185b3bf6e">&#9670;&nbsp;</a></span>WAIT_TICKS <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WAIT_TICKS&#160;&#160;&#160;1ULL</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a6b85cc358fb2a10935417f00e3daa2d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b85cc358fb2a10935417f00e3daa2d8">&#9670;&nbsp;</a></span>CC_XXX() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CC_XXX </td>
          <td>(</td>
          <td class="paramtype">TIMSK&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="io__m5__avr_8c.html#ab14495ae1f9667df5d198613bcc8d092">NTIMER</a>&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> &amp;</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8965273cef2ccefef88c849bff58d6f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8965273cef2ccefef88c849bff58d6f7">&#9670;&nbsp;</a></span>CC_XXX() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CC_XXX </td>
          <td>(</td>
          <td class="paramtype">TCCR&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="io__m5__avr_8c.html#ab14495ae1f9667df5d198613bcc8d092">NTIMER</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">B&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> &amp;</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad886765314d53f6e8cb3eeaac5bffda8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad886765314d53f6e8cb3eeaac5bffda8">&#9670;&nbsp;</a></span>CC_XXX() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CC_XXX </td>
          <td>(</td>
          <td class="paramtype">UCSR&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="io__m5__avr_8c.html#a45719155cbf4258c29211c2f5db49b9b">NUSART</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">B&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a57552be4efd362dfbaba37809d1f129d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57552be4efd362dfbaba37809d1f129d">&#9670;&nbsp;</a></span>io_m5_clean()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void io_m5_clean </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disable transmitting and receiving. </p>
<p>Unimplemented. </p>

</div>
</div>
<a id="ad572b5e5dccab0f1c5a962e08ce2912e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad572b5e5dccab0f1c5a962e08ce2912e">&#9670;&nbsp;</a></span>io_m5_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void io_m5_init </td>
          <td>(</td>
          <td class="paramtype">char const *&#160;</td>
          <td class="paramname"><em>path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare M5 motors to receive data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>Location of the motors, unused at the moment. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a515c36e7074c3d8f2a707f4dba147dd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a515c36e7074c3d8f2a707f4dba147dd6">&#9670;&nbsp;</a></span>io_m5_trans_set()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int io_m5_trans_set </td>
          <td>(</td>
          <td class="paramtype">int(*)()&#160;</td>
          <td class="paramname"><em>handler</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tell M5 motors to start receiving data. </p>
<p>Asynchronous (concurrent on pc) data writing. It will not be started until io_m5_offer_resume is called.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Function</td><td>that handles writing data to M5s. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a1297a12a88e41ab13442adb9bcace56d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1297a12a88e41ab13442adb9bcace56d">&#9670;&nbsp;</a></span>io_m5_trans_stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void io_m5_trans_stop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stops motors until resume is called. </p>

</div>
</div>
<a id="ab00f04dfb16c64ae321fc5294371b749"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab00f04dfb16c64ae321fc5294371b749">&#9670;&nbsp;</a></span>io_m5_trans_trywait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void io_m5_trans_trywait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Suspends data transmission until there is new data. </p>
<p>Should only be called from handler_m5_trans. </p>

</div>
</div>
<a id="a9f3c3159f49e3e0d4532b3d535a9184d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f3c3159f49e3e0d4532b3d535a9184d">&#9670;&nbsp;</a></span>io_m5_tripbuf_offer_resume()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void io_m5_tripbuf_offer_resume </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resumes motors after stopping. </p>
<p>May be interrupted by io_m5_tripbuf_update, but must not interrupt it.</p>
<p>Always leaves the USART Data Register Empty Interrupt Enabled. </p>

</div>
</div>
<a id="a17801e5afc9dfb2e05f1e96163cb2e84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17801e5afc9dfb2e05f1e96163cb2e84">&#9670;&nbsp;</a></span>io_m5_tripbuf_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char io_m5_tripbuf_read </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finds the tripbuf index to read from. </p>
<dl class="section return"><dt>Returns</dt><dd>the index of the buffer the data consumer should read from. Only changes if io_m5_tripbuf_update is called and returns true. </dd></dl>

</div>
</div>
<a id="a0c610858e0abe25cf8e34076675ad623"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c610858e0abe25cf8e34076675ad623">&#9670;&nbsp;</a></span>io_m5_tripbuf_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool io_m5_tripbuf_update </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates tripbuf with new data. </p>
<p>Causes io_m5_tripbuf_read to return index that was most recently 'submitted' by io_m5_tripbuf_offer_resume.</p>
<p>This should only be run between complete 'uses' of the data, to avoid using disparate data.</p>
<p>Unfortunately, since there is no way to have a lock-free/interruptible triple buffer implementation on the avr, this has to be platform-specific. A lock-free ring buffer would not handle cases when the producer is faster than the consumer well.</p>
<dl class="section return"><dt>Returns</dt><dd>True only if io_m5_tripbuf_offer_resume has been called (ie there is new data) since last call. </dd></dl>

</div>
</div>
<a id="a202b3ed317ffca6c49d8e70e7ba0d7a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a202b3ed317ffca6c49d8e70e7ba0d7a7">&#9670;&nbsp;</a></span>io_m5_tripbuf_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char io_m5_tripbuf_write </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finds the tripbuf index to write to. </p>
<dl class="section return"><dt>Returns</dt><dd>the index of the buffer the data producer should write to. Only changes when io_m5_tripbuf_offer_resume is called. </dd></dl>

</div>
</div>
<a id="ab71437ed7a0b59f87328b61002a1abaa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab71437ed7a0b59f87328b61002a1abaa">&#9670;&nbsp;</a></span>ISR() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="io__m5__avr_8c.html#ad886765314d53f6e8cb3eeaac5bffda8">CC_XXX</a>(USART, <a class="el" href="io__m5__avr_8c.html#a45719155cbf4258c29211c2f5db49b9b">NUSART</a>, _TX_vect)&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sets the pin to indicate to TTL&lt;-&gt;RS-485 converter to stop driving the lines (allowing someone else to transmit).</p>
<p>When writing to the USART, the pin should be set, and then unsetting it once there is nothing left to transmit can be left to this interrupt.</p>
<p>Unlike the Data Register Empty Interrupt, which triggers when UBRn is ready for a new byte to be written, this interrupt triggers when the last available bit has been pushed out of the USART, ie UBRn and the serial shift register are empty. In fact, the atmega2560 datasheet specifically mentions using this for RS-485. </p>

</div>
</div>
<a id="a3cd0140ea705c077b6df15a1f606acfd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cd0140ea705c077b6df15a1f606acfd">&#9670;&nbsp;</a></span>ISR() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="io__m5__avr_8c.html#ad886765314d53f6e8cb3eeaac5bffda8">CC_XXX</a>(USART, <a class="el" href="io__m5__avr_8c.html#a45719155cbf4258c29211c2f5db49b9b">NUSART</a>, _UDRE_vect)&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a9268369c511d1843e8ca6846fdc87c19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9268369c511d1843e8ca6846fdc87c19">&#9670;&nbsp;</a></span>clean</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile unsigned char clean</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac3eb02f1b9ff9632d44f0f20a8b18e2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3eb02f1b9ff9632d44f0f20a8b18e2e">&#9670;&nbsp;</a></span>io_m5</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FILE* io_m5</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= &amp;(FILE)FDEV_SETUP_STREAM(uart_m5_putchar, uart_m5_getchar,</div><div class="line">        _FDEV_SETUP_RW)</div></div><!-- fragment --><p>io with this is blocking, use io_m5_..._set to handle async io. </p>

</div>
</div>
<a id="aeabde82deeb112876f1360a7999bb7ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeabde82deeb112876f1360a7999bb7ff">&#9670;&nbsp;</a></span>new</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile unsigned char new</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab5ab23f12f203c3d4823a0746b033bc0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5ab23f12f203c3d4823a0746b033bc0">&#9670;&nbsp;</a></span>read</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char read</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a1c2cd2c01f90d3bf5e20b7ae1319c6d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c2cd2c01f90d3bf5e20b7ae1319c6d8">&#9670;&nbsp;</a></span>write</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char write</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
