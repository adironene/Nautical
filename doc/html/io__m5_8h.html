<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Nautical: include/m5/io_m5.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Nautical
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_5001be7b30768ee08602424918e66643.html">m5</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">io_m5.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Low-level communication function definitions for Videoray M5 motors.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for io_m5.h:</div>
<div class="dyncontent">
<div class="center"><img src="io__m5_8h__incl.png" border="0" usemap="#include_2m5_2io__m5_8h" alt=""/></div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="io__m5_8h__dep__incl.png" border="0" usemap="#include_2m5_2io__m5_8hdep" alt=""/></div>
<map name="include_2m5_2io__m5_8hdep" id="include_2m5_2io__m5_8hdep">
<area shape="rect" id="node2" href="io_8hpp.html" title="IO and kill switch function definitions. " alt="" coords="21,80,124,107"/>
</map>
</div>
</div>
<p><a href="io__m5_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad572b5e5dccab0f1c5a962e08ce2912e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5_8h.html#ad572b5e5dccab0f1c5a962e08ce2912e">io_m5_init</a> (char const *path)</td></tr>
<tr class="memdesc:ad572b5e5dccab0f1c5a962e08ce2912e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare M5 motors to receive data.  <a href="#ad572b5e5dccab0f1c5a962e08ce2912e">More...</a><br /></td></tr>
<tr class="separator:ad572b5e5dccab0f1c5a962e08ce2912e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57552be4efd362dfbaba37809d1f129d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5_8h.html#a57552be4efd362dfbaba37809d1f129d">io_m5_clean</a> ()</td></tr>
<tr class="memdesc:a57552be4efd362dfbaba37809d1f129d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disable transmitting and receiving.  <a href="#a57552be4efd362dfbaba37809d1f129d">More...</a><br /></td></tr>
<tr class="separator:a57552be4efd362dfbaba37809d1f129d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a515c36e7074c3d8f2a707f4dba147dd6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5_8h.html#a515c36e7074c3d8f2a707f4dba147dd6">io_m5_trans_set</a> (int(*handler)())</td></tr>
<tr class="memdesc:a515c36e7074c3d8f2a707f4dba147dd6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tell M5 motors to start receiving data.  <a href="#a515c36e7074c3d8f2a707f4dba147dd6">More...</a><br /></td></tr>
<tr class="separator:a515c36e7074c3d8f2a707f4dba147dd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab00f04dfb16c64ae321fc5294371b749"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5_8h.html#ab00f04dfb16c64ae321fc5294371b749">io_m5_trans_trywait</a> ()</td></tr>
<tr class="memdesc:ab00f04dfb16c64ae321fc5294371b749"><td class="mdescLeft">&#160;</td><td class="mdescRight">Suspends data transmission until there is new data.  <a href="#ab00f04dfb16c64ae321fc5294371b749">More...</a><br /></td></tr>
<tr class="separator:ab00f04dfb16c64ae321fc5294371b749"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1297a12a88e41ab13442adb9bcace56d"><td class="memItemLeft" align="right" valign="top"><a id="a1297a12a88e41ab13442adb9bcace56d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5_8h.html#a1297a12a88e41ab13442adb9bcace56d">io_m5_trans_stop</a> ()</td></tr>
<tr class="memdesc:a1297a12a88e41ab13442adb9bcace56d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops motors until resume is called. <br /></td></tr>
<tr class="separator:a1297a12a88e41ab13442adb9bcace56d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c610858e0abe25cf8e34076675ad623"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5_8h.html#a0c610858e0abe25cf8e34076675ad623">io_m5_tripbuf_update</a> ()</td></tr>
<tr class="memdesc:a0c610858e0abe25cf8e34076675ad623"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates tripbuf with new data.  <a href="#a0c610858e0abe25cf8e34076675ad623">More...</a><br /></td></tr>
<tr class="separator:a0c610858e0abe25cf8e34076675ad623"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f3c3159f49e3e0d4532b3d535a9184d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5_8h.html#a9f3c3159f49e3e0d4532b3d535a9184d">io_m5_tripbuf_offer_resume</a> ()</td></tr>
<tr class="memdesc:a9f3c3159f49e3e0d4532b3d535a9184d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resumes motors after stopping.  <a href="#a9f3c3159f49e3e0d4532b3d535a9184d">More...</a><br /></td></tr>
<tr class="separator:a9f3c3159f49e3e0d4532b3d535a9184d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17801e5afc9dfb2e05f1e96163cb2e84"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5_8h.html#a17801e5afc9dfb2e05f1e96163cb2e84">io_m5_tripbuf_read</a> ()</td></tr>
<tr class="memdesc:a17801e5afc9dfb2e05f1e96163cb2e84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds the tripbuf index to read from.  <a href="#a17801e5afc9dfb2e05f1e96163cb2e84">More...</a><br /></td></tr>
<tr class="separator:a17801e5afc9dfb2e05f1e96163cb2e84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a202b3ed317ffca6c49d8e70e7ba0d7a7"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5_8h.html#a202b3ed317ffca6c49d8e70e7ba0d7a7">io_m5_tripbuf_write</a> ()</td></tr>
<tr class="memdesc:a202b3ed317ffca6c49d8e70e7ba0d7a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds the tripbuf index to write to.  <a href="#a202b3ed317ffca6c49d8e70e7ba0d7a7">More...</a><br /></td></tr>
<tr class="separator:a202b3ed317ffca6c49d8e70e7ba0d7a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ac3eb02f1b9ff9632d44f0f20a8b18e2e"><td class="memItemLeft" align="right" valign="top">FILE *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io__m5_8h.html#ac3eb02f1b9ff9632d44f0f20a8b18e2e">io_m5</a></td></tr>
<tr class="separator:ac3eb02f1b9ff9632d44f0f20a8b18e2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Low-level communication function definitions for Videoray M5 motors. </p>
<dl class="section author"><dt>Author</dt><dd>Seth Girvan (Lord) </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a57552be4efd362dfbaba37809d1f129d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57552be4efd362dfbaba37809d1f129d">&#9670;&nbsp;</a></span>io_m5_clean()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void io_m5_clean </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disable transmitting and receiving. </p>
<p>Unimplemented. </p>

</div>
</div>
<a id="ad572b5e5dccab0f1c5a962e08ce2912e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad572b5e5dccab0f1c5a962e08ce2912e">&#9670;&nbsp;</a></span>io_m5_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void io_m5_init </td>
          <td>(</td>
          <td class="paramtype">char const *&#160;</td>
          <td class="paramname"><em>path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare M5 motors to receive data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>Location of the motors, unused at the moment. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a515c36e7074c3d8f2a707f4dba147dd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a515c36e7074c3d8f2a707f4dba147dd6">&#9670;&nbsp;</a></span>io_m5_trans_set()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int io_m5_trans_set </td>
          <td>(</td>
          <td class="paramtype">int(*)()&#160;</td>
          <td class="paramname"><em>handler</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tell M5 motors to start receiving data. </p>
<p>Asynchronous (concurrent on pc) data writing. It will not be started until io_m5_offer_resume is called.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Function</td><td>that handles writing data to M5s. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab00f04dfb16c64ae321fc5294371b749"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab00f04dfb16c64ae321fc5294371b749">&#9670;&nbsp;</a></span>io_m5_trans_trywait()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void io_m5_trans_trywait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Suspends data transmission until there is new data. </p>
<p>To be called from the transmission handler (ie io_m5_trans_set argument). Meant to be called after finishing transmission of a packet.</p>
<p>If io_m5_tripbuf_offer_resume has not been called since the last call of io_m5_tripbuf_update, then the transmission handler is suspended for ~.5 seconds or until io_m5_offer_resume is called, whichever is first. If there is new triple buffer data available, returns immediately.</p>
<p>By default, a thruster will automatically set itself to power 0 if it has not received a command for over a second. While this can be disabled, it provides useful safety in case something goes fatally wrong in our software or there are connection problems. We could just transmit continuously (on the avr, never disabling the Data Register Ready Interrupt, but at 115,200 baud, that is a lot of processing wasted on the interrupt). While could probably just rely on io_m5_trans_offer_resume being called at least once a second, this times out after .5 seconds (arbitrary margin of safety) just in case.</p>
<p>Should only be called from handler_m5_trans. </p>

</div>
</div>
<a id="a9f3c3159f49e3e0d4532b3d535a9184d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f3c3159f49e3e0d4532b3d535a9184d">&#9670;&nbsp;</a></span>io_m5_tripbuf_offer_resume()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void io_m5_tripbuf_offer_resume </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resumes motors after stopping. </p>
<p>Makes the current write index available to io_m5_tripbuf_update, and changes the value returned by io_m5_tripbuf_write.</p>
<p>Every value in the write triple buffer (eg buf[<a class="el" href="io__m5_8h.html#a202b3ed317ffca6c49d8e70e7ba0d7a7" title="Finds the tripbuf index to write to. ">io_m5_tripbuf_write()</a>] ) should be written before calling this, as unwritten areas have unspecified value.</p>
<p>Also resumes the transmission handler if it is paused (so it will start transmitting the new data asap). io_m5_trans_set must be called before this is called.</p>
<p>May be interrupted by io_m5_tripbuf_update, but must not interrupt it.</p>
<p>Always leaves the USART Data Register Empty Interrupt Enabled. </p>

</div>
</div>
<a id="a17801e5afc9dfb2e05f1e96163cb2e84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17801e5afc9dfb2e05f1e96163cb2e84">&#9670;&nbsp;</a></span>io_m5_tripbuf_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char io_m5_tripbuf_read </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finds the tripbuf index to read from. </p>
<dl class="section return"><dt>Returns</dt><dd>The index of the buffer the data consumer should read from. Only changes if io_m5_tripbuf_update is called and returns true. </dd></dl>

</div>
</div>
<a id="a0c610858e0abe25cf8e34076675ad623"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c610858e0abe25cf8e34076675ad623">&#9670;&nbsp;</a></span>io_m5_tripbuf_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool io_m5_tripbuf_update </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates tripbuf with new data. </p>
<p>Causes io_m5_tripbuf_read to return index that was most recently 'submitted' by io_m5_tripbuf_offer_resume.</p>
<p>This should only be run between complete 'uses' of the data, to avoid using disparate data.</p>
<p>Unfortunately, since there is no way to have a lock-free/interruptible triple buffer implementation on the avr, this has to be platform-specific. A lock-free ring buffer would not handle cases when the producer is faster than the consumer well.</p>
<dl class="section return"><dt>Returns</dt><dd>True only if io_m5_tripbuf_offer_resume has been called (ie there is new data) since last call. </dd></dl>

</div>
</div>
<a id="a202b3ed317ffca6c49d8e70e7ba0d7a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a202b3ed317ffca6c49d8e70e7ba0d7a7">&#9670;&nbsp;</a></span>io_m5_tripbuf_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char io_m5_tripbuf_write </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finds the tripbuf index to write to. </p>
<dl class="section return"><dt>Returns</dt><dd>The index of the buffer the data producer should write to. Only changes when io_m5_tripbuf_offer_resume is called. </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ac3eb02f1b9ff9632d44f0f20a8b18e2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3eb02f1b9ff9632d44f0f20a8b18e2e">&#9670;&nbsp;</a></span>io_m5</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FILE* io_m5</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>io with this is blocking, use io_m5_..._set to handle async io. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
